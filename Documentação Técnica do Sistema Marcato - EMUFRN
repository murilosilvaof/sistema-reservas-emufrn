**DocumentaÃ§Ã£o TÃ©cnica Completa - Sistema Marcato (EMUFRN)**

## ğŸ“Œ IntroduÃ§Ã£o

O **Marcato** Ã© um sistema web desenvolvido para gerenciar a reserva de espaÃ§os da Escola de MÃºsica da UFRN. Seu principal objetivo Ã© automatizar o processo de agendamento, envio de e-mails de confirmaÃ§Ã£o e integraÃ§Ã£o com o Google Calendar institucional, melhorando a organizaÃ§Ã£o e evitando conflitos de uso dos espaÃ§os.

A aplicaÃ§Ã£o foi construÃ­da utilizando as seguintes tecnologias:

* **Frontend**: HTML, CSS e JavaScript
* **Backend**: PHP (com Composer)
* **Banco de dados**: MySQL
* **E-mails**: PHPMailer com SMTP
* **IntegraÃ§Ã£o externa**: Google Calendar API via OAuth 2.0

O sistema estÃ¡ hospedado temporariamente na Hostinger ([https://ismcursos.com/marcato](https://ismcursos.com/marcato)) e serÃ¡ migrado para o servidor da UFRN apÃ³s validaÃ§Ã£o final.

---

## ğŸ—‚ Estrutura do Projeto

### Raiz do projeto (`public_html/marcato/`):

#### `index.html`

* PÃ¡gina principal.
* Apresenta seleÃ§Ã£o de salas e um calendÃ¡rio de dias do mÃªs.
* O usuÃ¡rio clica em um dia e horÃ¡rio e Ã© redirecionado para `formulario.html` com os parÃ¢metros selecionados via URL.

#### `formulario.html`

* Recebe os parÃ¢metros via URL (sala, dia, horÃ¡rio) e os prÃ©-preenche.
* Exibe formulÃ¡rio para preenchimento de:

  * Nome completo
  * Tipo de instrumento
  * MatrÃ­cula
  * E-mail
  * Tipo de evento
  * Perfil (aluno, professor, tÃ©cnico)
  * ObservaÃ§Ãµes (nome do evento, telefone, etc.)
* Ao submeter, envia os dados para `processa_reserva.php` via POST.

#### `processa_reserva.php`

* Conecta ao banco de dados `reservas_espacos`.
* Insere os dados enviados no formulÃ¡rio.
* Gera um ID Ãºnico para a reserva.
* Envia e-mail automÃ¡tico para `producao@musica.ufrn.br` com os dados da reserva e dois botÃµes:

  * âœ… Confirmar Reserva â†’ aponta para `resposta.php?id={id}&acao=confirmar`
  * âŒ Recusar Reserva â†’ aponta para `resposta.php?id={id}&acao=recusar`
* Mensagem visual de sucesso ou falha Ã© exibida ao usuÃ¡rio.

#### `resposta.php`

* Recebe os parÃ¢metros `id` e `acao` via GET.
* Atualiza o status da reserva no banco como `confirmada` ou `recusada`.
* Se a aÃ§Ã£o for "confirmar", o sistema:

  * Acessa os dados da reserva pelo ID
  * Cria um evento automaticamente no Google Calendar institucional usando a API do Google
* Exibe uma pÃ¡gina com o resultado da aÃ§Ã£o ao responsÃ¡vel.

#### `send_email.php`

* Script alternativo de envio de e-mail com base em dados de teste.
* Utilizado para testes de layout e envio SMTP fora do fluxo principal.

#### `get_token.php`

* ResponsÃ¡vel por autenticar o sistema com a API do Google.
* Abre a tela de autorizaÃ§Ã£o do Google para o administrador autorizar o uso da conta institucional ([producao@musica.ufrn.br](mailto:producao@musica.ufrn.br)).
* Ao autorizar, o token de acesso Ã© salvo no arquivo `token.json`.
* Esse token Ã© reutilizado para inserir eventos na agenda.

#### `credenciais.json`

* Arquivo obtido no Google Cloud Console ao criar as credenciais OAuth.
* ContÃ©m:

  * client\_id
  * client\_secret
  * redirect\_uri (deve ser `https://dominio.com/get_token.php`)
* **Importante**: nunca deve ser publicado publicamente.

#### `token.json`

* Arquivo gerado apÃ³s a autenticaÃ§Ã£o bem-sucedida com a conta do Google.
* ContÃ©m os dados de acesso Ã  API (token de acesso e refresh\_token).
* Deve ter permissÃ£o de escrita no servidor.

#### `vendor/`

* Pasta gerada automaticamente apÃ³s rodar `composer install`.
* ContÃ©m todas as dependÃªncias externas do projeto, como:

  * `google/apiclient` (Google Calendar)
  * `phpmailer/phpmailer` (e-mails)
  * `guzzlehttp/guzzle`, `psr/log` e outras
* Arquivo importante: `vendor/autoload.php`, necessÃ¡rio para carregar todas as bibliotecas.

---

## ğŸ” IntegraÃ§Ã£o com Google Calendar

### Acesso via OAuth 2.0

1. Acesse o [Google Cloud Console](https://console.cloud.google.com/)
2. Crie um projeto chamado `marcato-calendar`
3. Habilite a API `Google Calendar API`
4. VÃ¡ atÃ© "Credenciais" e crie um **ID do cliente OAuth 2.0**

   * Tipo: Aplicativo da Web
   * Redirect URI: `https://seusite.com/get_token.php`
5. Baixe o arquivo `credenciais.json`
6. Coloque no servidor, no mesmo diretÃ³rio do `get_token.php`

### GeraÃ§Ã£o do Token

* Acesse `get_token.php` pela web
* Clique em "Autorizar acesso"
* FaÃ§a login com a conta institucional do Google
* Ao autorizar, o sistema salva `token.json` automaticamente

### InserÃ§Ã£o de eventos

O `resposta.php`, ao confirmar uma reserva, executa o seguinte fluxo:

1. LÃª os dados da reserva confirmada do banco
2. Usa `Google_Client` com `credenciais.json` e `token.json`
3. Cria um objeto `Google_Service_Calendar_Event`
4. Preenche:

   * summary: nome do evento (campo obs)
   * location: nome da sala
   * description: nome e e-mail do responsÃ¡vel
   * start / end: data e horÃ¡rio convertidos para formato ISO
5. Insere o evento na agenda `producao@musica.ufrn.br`

---

## ğŸ—ƒ Banco de Dados: `reservas_espacos`

Tabela principal usada no sistema:

| Campo        | Tipo     | DescriÃ§Ã£o                        |
| ------------ | -------- | -------------------------------- |
| id           | int (PK) | Identificador da reserva         |
| nome         | varchar  | Nome do solicitante              |
| instrumento  | varchar  | Tipo de instrumento              |
| matricula    | varchar  | MatrÃ­cula                        |
| email        | varchar  | E-mail do solicitante            |
| sala         | varchar  | Nome do espaÃ§o                   |
| tipo\_evento | varchar  | Ensaio, apresentaÃ§Ã£o, recital    |
| perfil       | varchar  | Aluno, Professor, TÃ©cnico        |
| dia          | date     | Data da reserva                  |
| horario      | time     | HorÃ¡rio da reserva               |
| obs          | text     | ObservaÃ§Ãµes / nome do evento     |
| status       | varchar  | pendente, confirmada ou recusada |

---

## ğŸ”’ SeguranÃ§a

* `credenciais.json` e `token.json` nÃ£o devem ser expostos publicamente
* Arquivos devem ter permissÃµes restritas (644) e estarem fora do diretÃ³rio acessÃ­vel se possÃ­vel
* O banco de dados deve estar protegido e nÃ£o exposto via URL direta

---

## ğŸ§ª Testes

* O sistema pode ser testado acessando o fluxo completo:

  * `index.html` > `formulario.html` > `processa_reserva.php`
  * E-mail deve chegar ao responsÃ¡vel
  * BotÃ£o "Confirmar" deve acionar `resposta.php` com atualizaÃ§Ã£o no banco e inclusÃ£o no Google Agenda

---

## ğŸ§° Requisitos do Servidor

* PHP 7.4 ou superior
* ExtensÃµes habilitadas: `curl`, `openssl`, `mbstring`, `json`
* Acesso a comandos Composer (ou upload manual da pasta vendor)
* Acesso a SMTP (porta 587 ou TLS)
* PermissÃ£o de escrita no arquivo `token.json`

---

## ğŸ“Œ PublicaÃ§Ã£o no Servidor da UFRN

Recomenda-se:

* Criar subdiretÃ³rio `marcato/` em `musica.ufrn.br`
* Configurar PHP com suporte a dependÃªncias externas
* Gerar token com `get_token.php`
* Armazenar com seguranÃ§a os arquivos `credenciais.json` e `token.json`
* Garantir conectividade com Google Calendar via HTTPS

---

## ğŸ‘¨ğŸ»â€ğŸ’» Desenvolvedor

**Murilo Francisco da Silva**
**E-mail:** [murilodevweb@gmail.com](mailto:murilodevweb@gmail.com)
**LinkedIn:** [https://www.linkedin.com/in/murilofrancisco/](https://www.linkedin.com/in/murilofrancisco/)

**Projeto:** Sistema Marcato - EMUFRN
**VersÃ£o:** 1.0.0
**Hospedagem atual:** [https://ismcursos.com/marcato](https://ismcursos.com/marcato)

---

*Esta documentaÃ§Ã£o Ã© parte oficial do sistema e deve acompanhar futuras atualizaÃ§Ãµes, correÃ§Ãµes e integraÃ§Ãµes institucionais.*
